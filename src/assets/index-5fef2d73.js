import{s as T,_ as P,r as i,q as D,u as g,E as W,o as R,c as $,w as l,b as t,d as h,e as b,as as H,at as G,m as _,ar as z,g as J,aq as K,j as M,t as Q,au as X}from"./index-08ed677d.js";import{_ as Y,a as Z,C as ee}from"./index-7b650976.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./index-5362a68f.js";import{i as V}from"./index-c83262a0.js";import{A as te,a as ae}from"./ArrowDownOutlined-7e142083.js";import{T as le,a as oe,b as ne}from"./index-ffe2e608.js";import"./vuedraggable.umd-a1c90dfc.js";import"./index-9d5a19c2.js";import"./Group-db28a0f9.js";import"./createForOfIteratorHelper-a50550d1.js";import"./css-aae66f86.js";import"./useMaxLevel-5fff0ff6.js";import"./index-5353e7c4.js";import"./RadioButton-b1164875.js";import"./CaretDownOutlined-5ddc51ec.js";import"./CaretUpOutlined-d8859d1d.js";import"./iconUtil-c5959902.js";async function se(v){const r=await T.get("https://cdn.eleadmin.com/20200610/document.json",{params:v});return r.data.code===0&&r.data.data?r.data.data:Promise.reject(new Error(r.data.message))}async function ie(v){const r=await T.get("https://cdn.eleadmin.com/20200610/archive.json",{params:v});return r.data.code===0&&r.data.data?r.data.data:Promise.reject(new Error(r.data.message))}const re={__name:"file-sort",props:{visible:Boolean,documents:Array},emits:["update:visible"],setup(v,{emit:r}){const x=v,S=i([{title:"案卷题名",dataIndex:"title",ellipsis:!0},{title:"案卷档号",dataIndex:"piece_no",ellipsis:!0}]),k=i([{title:"文件题名",dataIndex:"title",ellipsis:!0},{title:"文件档号",dataIndex:"archive_no",ellipsis:!0}]),o=i([]),c=i(null),f=i(!0),a=i([]),d=i([]),y=D(()=>g(c)?o.value.filter(e=>{var s;return e.piece_no===((s=g(c))==null?void 0:s.piece_no)}):[]),U=D(()=>o.value.filter(e=>!e.piece_no)),m=()=>{if(!a.value.length){_.error("请选择一条数据");return}if(a.value.length>1){_.error("只能选择一条数据");return}if(y.value.indexOf(a.value[0])===0)return;const e=o.value.indexOf(a.value[0]),s=o.value[e-1];o.value[e-1]=a.value[0],o.value[e]=s,a.value=[o.value[e-1]]},n=()=>{if(!a.value.length){_.error("请选择一条数据");return}if(a.value.length>1){_.error("只能选择一条数据");return}if(y.value.indexOf(a.value[0])===y.value.length-1)return;const e=o.value.indexOf(a.value[0]),s=o.value[e+1];o.value[e+1]=a.value[0],o.value[e]=s,a.value=[o.value[e+1]]},p=()=>{if(!a.value.length){_.error("请至少选择一条数据");return}a.value.forEach(e=>{e.piece_no=""}),a.value=[]},w=()=>{if(g(c)){if(!d.value.length){_.error("请至少选择一条数据");return}d.value.forEach(e=>{var s;e.piece_no=(s=g(c))==null?void 0:s.piece_no}),d.value=[]}},u=()=>{const e=o.value.map(s=>({archive_no:s.archive_no,piece_no:s.piece_no}));console.log(e),_.success("调整成功"),I()},I=()=>{o.value=[],a.value=[],d.value=[],C(!1)},C=e=>{r("update:visible",e)},A=e=>{c.value=e,a.value=[]},E=()=>{f.value=!0,ie({piece_no_in:x.documents.map(e=>e.piece_no)}).then(e=>{f.value=!1,o.value=e,c.value=x.documents[0]}).catch(e=>{f.value=!1,_.error(e.message)})};return W(()=>x.documents,e=>{e.length&&E()}),(e,s)=>{const N=V,j=Y,O=z,q=J,F=Z,L=K;return R(),$(L,{width:1200,visible:v.visible,title:"卷内文件调整","body-style":{padding:"16px 16px 0 16px"},"onUpdate:visible":C,onCancel:I,onOk:u},{default:l(()=>[t(F,{gutter:16},{default:l(()=>[t(j,{lg:8,md:24,sm:24,xs:24},{default:l(()=>[t(N,{bordered:"",size:"small",toolkit:[],height:"360px",current:c.value,"need-page":!1,"row-key":"piece_no","sub-title":"案卷列表",columns:S.value,"tools-theme":"default",datasource:v.documents,scroll:{x:280},"selection-type":"radio","row-selection":{columnWidth:38},"tool-style":{padding:"7px 14px"},class:"demo-file-sort-table",style:{"margin-bottom":"16px"},"onUpdate:current":A},null,8,["current","columns","datasource"])]),_:1}),t(j,{lg:8,md:24,sm:24,xs:24},{default:l(()=>[t(N,{bordered:"",size:"small",toolkit:[],height:"360px","need-page":!1,loading:f.value,"sub-title":"卷内列表",datasource:y.value,columns:k.value,"row-key":"archive_no","tools-theme":"default",scroll:{x:280},selection:a.value,"onUpdate:selection":s[0]||(s[0]=B=>a.value=B),"row-selection":{columnWidth:38},class:"demo-file-sort-table",style:{"margin-bottom":"16px"}},{toolkit:l(()=>[t(q,null,{default:l(()=>[t(O,{ghost:"",type:"primary",class:"ele-btn-icon",onClick:m},{default:l(()=>[h("span",null,[t(g(te)),b("上移")])]),_:1}),t(O,{ghost:"",type:"primary",class:"ele-btn-icon",onClick:n},{default:l(()=>[h("span",null,[t(g(ae)),b("下移")])]),_:1}),t(O,{ghost:"",type:"primary",class:"ele-btn-icon",onClick:p},{default:l(()=>[h("span",null,[b("调出"),t(g(H))])]),_:1})]),_:1})]),_:1},8,["loading","datasource","columns","selection"])]),_:1}),t(j,{lg:8,md:24,sm:24,xs:24},{default:l(()=>[t(N,{bordered:"",size:"small",toolkit:[],height:"360px","need-page":!1,loading:f.value,datasource:U.value,columns:k.value,"sub-title":"未归档列表","row-key":"archive_no","tools-theme":"default",scroll:{x:280},selection:d.value,"onUpdate:selection":s[1]||(s[1]=B=>d.value=B),"row-selection":{columnWidth:38},class:"demo-file-sort-table",style:{"margin-bottom":"16px"}},{toolkit:l(()=>[t(O,{ghost:"",type:"primary",class:"ele-btn-icon",onClick:w},{default:l(()=>[h("span",null,[t(g(G)),b(" 调入")])]),_:1})]),_:1},8,["loading","datasource","columns","selection"])]),_:1})]),_:1})]),_:1},8,["visible"])}}},ue=P(re,[["__scopeId","data-v-fc20f3db"]]),ce={class:"ele-body"},de=h("span",null,[b(" 高度铺满"),h("s"),h("s")],-1),me={name:"ExampleDocument"},De=Object.assign(me,{setup(v){const r=i(null),x=i([]),S=({page:m,limit:n})=>se({page:m,limit:n}),k=i([{key:"index",width:48,align:"center",fixed:"left",hideInSetting:!0,customRender:({index:m})=>{var n,p;return m+((p=(n=r.value)==null?void 0:n.tableIndex)!=null?p:0)}},{title:"案卷档号",dataIndex:"piece_no",ellipsis:!0},{title:"案卷题名",dataIndex:"title",ellipsis:!0},{title:"年度",dataIndex:"year",width:100,ellipsis:!0},{title:"保管期限",dataIndex:"retention",width:120,ellipsis:!0},{title:"密级",dataIndex:"secret",width:100,ellipsis:!0},{title:"档案类别",dataIndex:"type",ellipsis:!0},{title:"载体规格",dataIndex:"carrier",width:120,ellipsis:!0},{title:"件数",dataIndex:"amount",ellipsis:!0}]),o=i([]),c=i(!1),f=i([]),a=i(0),d=i(!1),y=m=>{x.value=m.data,a.value=m.data.map(n=>Number(n.amount)).reduce((n,p)=>{const w=Number(p);return isNaN(w)?n:n+p},0)},U=()=>{if(o.value.length<2){_.error("请至少选择两条数据");return}f.value=x.value.slice(0,3),c.value=!0};return(m,n)=>{const p=z,w=X,u=le,I=oe,C=ne,A=V,E=ee;return R(),M("div",ce,[t(E,{bordered:!1,"body-style":{padding:"10px 20px"}},{default:l(()=>[t(A,{ref_key:"tableRef",ref:r,"row-key":"piece_no",columns:k.value,datasource:S,selection:o.value,"onUpdate:selection":n[1]||(n[1]=e=>o.value=e),scroll:{x:900},height:d.value?"calc(100vh - 420px)":void 0,onDone:y},{toolbar:l(()=>[t(p,{type:"primary",class:"ele-btn-icon",onClick:U},{default:l(()=>[b(" 卷内文件调整 ")]),_:1}),de,t(w,{checked:d.value,"onUpdate:checked":n[0]||(n[0]=e=>d.value=e),size:"small"},null,8,["checked"])]),summary:l(()=>[t(C,{fixed:""},{default:l(()=>[t(I,null,{default:l(()=>[t(u),t(u),t(u,null,{default:l(()=>[b("合计")]),_:1}),t(u),t(u),t(u),t(u),t(u),t(u),t(u,null,{default:l(()=>[b(Q(a.value),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["columns","selection","height"])]),_:1}),t(ue,{visible:c.value,"onUpdate:visible":n[2]||(n[2]=e=>c.value=e),documents:f.value},null,8,["visible","documents"])])}}});export{De as default};
