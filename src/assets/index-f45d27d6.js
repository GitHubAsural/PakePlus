import{aG as D,r as T,o as p,c as y,w as e,b as t,u as h,e as f,ax as F,aw as B,ar as I,g as R,az as L,s as N,N as k,j as S,F as M,an as b,d as O,aU as P,m as j,ao as U}from"./index-08ed677d.js";import{_ as V,a as Y,C as K}from"./index-7b650976.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./index-5362a68f.js";import{i as q}from"./index-c83262a0.js";import{w as z,u as G}from"./xlsx-08161fdb.js";import{R as $}from"./index-ff37d263.js";import{D as A}from"./DownloadOutlined-28687348.js";import"./vuedraggable.umd-a1c90dfc.js";import"./index-9d5a19c2.js";import"./Group-db28a0f9.js";import"./createForOfIteratorHelper-a50550d1.js";import"./index-ffe2e608.js";import"./css-aae66f86.js";import"./useMaxLevel-5fff0ff6.js";import"./index-5353e7c4.js";import"./RadioButton-b1164875.js";import"./CaretDownOutlined-5ddc51ec.js";import"./CaretUpOutlined-d8859d1d.js";import"./iconUtil-c5959902.js";const H={__name:"login-record-search",emits:["search"],setup(g,{emit:a}){const{form:u,resetFields:v}=D({username:"",nickname:""}),d=T(["",""]),w=()=>{var i;const[r,o]=(i=d.value)!=null?i:[];a("search",{...u,createTimeStart:r?r+" 00:00:00":"",createTimeEnd:o?o+" 23:59:59":""})},l=()=>{v(),d.value=["",""],w()};return(r,o)=>{const i=F,n=B,c=V,m=$,s=I,_=R,C=Y,E=L;return p(),y(E,{"label-col":{xl:7,lg:5,md:7,sm:4},"wrapper-col":{xl:17,lg:19,md:17,sm:20}},{default:e(()=>[t(C,{gutter:8},{default:e(()=>[t(c,{xl:6,lg:12,md:12,sm:24,xs:24},{default:e(()=>[t(n,{label:"用户账号"},{default:e(()=>[t(i,{value:h(u).username,"onUpdate:value":o[0]||(o[0]=x=>h(u).username=x),valueModifiers:{trim:!0},placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1})]),_:1}),t(c,{xl:6,lg:12,md:12,sm:24,xs:24},{default:e(()=>[t(n,{label:"用户名"},{default:e(()=>[t(i,{value:h(u).nickname,"onUpdate:value":o[1]||(o[1]=x=>h(u).nickname=x),valueModifiers:{trim:!0},placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1})]),_:1}),t(c,{xl:6,lg:12,md:12,sm:24,xs:24},{default:e(()=>[t(n,{label:"登录时间"},{default:e(()=>[t(m,{value:d.value,"onUpdate:value":o[2]||(o[2]=x=>d.value=x),"value-format":"YYYY-MM-DD",class:"ele-fluid"},null,8,["value"])]),_:1})]),_:1}),t(c,{xl:6,lg:12,md:12,sm:24,xs:24},{default:e(()=>[t(n,{class:"ele-text-right","wrapper-col":{span:24}},{default:e(()=>[t(_,null,{default:e(()=>[t(s,{type:"primary",onClick:w},{default:e(()=>[f("查询")]),_:1}),t(s,{onClick:l},{default:e(()=>[f("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}};async function J(g){const a=await N.get("/system/login-record/page",{params:g});return a.data.code===0?a.data.data:Promise.reject(new Error(a.data.message))}async function Q(g){const a=await N.get("/system/login-record",{params:g});return a.data.code===0&&a.data.data?a.data.data:Promise.reject(new Error(a.data.message))}const W={class:"ele-body"},X=O("span",null,"导出",-1),Z={name:"SystemLoginRecord"},ke=Object.assign(Z,{setup(g){const a=T(null),u=T([{key:"index",width:48,align:"center",fixed:"left",hideInSetting:!0,customRender:({index:l})=>{var r,o;return l+((o=(r=a.value)==null?void 0:r.tableIndex)!=null?o:0)}},{title:"账号",dataIndex:"username",sorter:!0,showSorterTooltip:!1},{title:"用户名",dataIndex:"nickname",sorter:!0,showSorterTooltip:!1},{title:"IP地址",dataIndex:"ip",sorter:!0,showSorterTooltip:!1,ellipsis:!0},{title:"设备型号",dataIndex:"device",sorter:!0,showSorterTooltip:!1,ellipsis:!0},{title:"操作系统",dataIndex:"os",sorter:!0,showSorterTooltip:!1,ellipsis:!0},{title:"浏览器",dataIndex:"browser",sorter:!0,showSorterTooltip:!1,ellipsis:!0},{title:"操作类型",key:"loginType",dataIndex:"loginType",sorter:!0,showSorterTooltip:!1,width:120,filters:[{text:"登录成功",value:0},{text:"登录失败",value:1},{text:"退出登录",value:2},{text:"刷新TOKEN",value:3}],filterMultiple:!1},{title:"备注",dataIndex:"comments",sorter:!0,showSorterTooltip:!1,ellipsis:!0},{title:"登录时间",dataIndex:"createTime",sorter:!0,showSorterTooltip:!1,ellipsis:!0,customRender:({text:l})=>k(l)}]),v=({page:l,limit:r,where:o,orders:i,filters:n})=>J({...o,...i,...n,page:l,limit:r}),d=l=>{var r;(r=a==null?void 0:a.value)==null||r.reload({page:1,where:l})},w=()=>{var o;const l=[["账号","用户名","IP地址","设备型号","操作系统","浏览器","操作类型","备注","登录时间"]],r=P("请求中..",0);(o=a.value)==null||o.doRequest(({where:i,orders:n,filters:c})=>{Q({...i,...n,...c}).then(m=>{r(),m.forEach(s=>{l.push([s.username,s.nickname,s.ip,s.device,s.os,s.browser,["登录成功","登录失败","退出登录","刷新TOKEN"][s.loginType],s.comments,k(s.createTime)])}),z({SheetNames:["Sheet1"],Sheets:{Sheet1:G.aoa_to_sheet(l)}},"登录日志.xlsx")}).catch(m=>{r(),j.error(m.message)})})};return(l,r)=>{const o=I,i=R,n=U,c=q,m=K;return p(),S("div",W,[t(m,{bordered:!1},{default:e(()=>[t(H,{onSearch:d}),t(c,{ref_key:"tableRef",ref:a,"row-key":"id",columns:u.value,datasource:v,scroll:{x:900},"cache-key":"proSystemLoginRecordTable"},{toolbar:e(()=>[t(i,null,{default:e(()=>[t(o,{type:"primary",class:"ele-btn-icon",onClick:w},{icon:e(()=>[t(h(A))]),default:e(()=>[X]),_:1})]),_:1})]),bodyCell:e(({column:s,record:_})=>[s.key==="loginType"?(p(),S(M,{key:0},[_.loginType===0?(p(),y(n,{key:0,color:"green"},{default:e(()=>[f("登录成功")]),_:1})):_.loginType===1?(p(),y(n,{key:1,color:"red"},{default:e(()=>[f(" 登录失败 ")]),_:1})):_.loginType===2?(p(),y(n,{key:2},{default:e(()=>[f("退出登录")]),_:1})):_.loginType===3?(p(),y(n,{key:3,color:"orange"},{default:e(()=>[f(" 刷新TOKEN ")]),_:1})):b("",!0)],64)):b("",!0)]),_:1},8,["columns"])]),_:1})])}}});export{ke as default};
