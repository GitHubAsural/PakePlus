import{aG as j,r as T,o as u,c as b,w as t,b as e,u as h,e as C,ax as V,aw as $,ar as O,g as N,az as U,_ as P,j as I,d,t as c,M as Y,aF as z,N as R,an as D,ao as E,h as H,aq as G,s as F,F as L,aU as A,m as J}from"./index-08ed677d.js";import{_ as q,a as B,C as K}from"./index-7b650976.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./index-5362a68f.js";import{i as Q}from"./index-c83262a0.js";import{w as W,u as X}from"./xlsx-08161fdb.js";import{R as Z}from"./index-ff37d263.js";import{U as ee}from"./UpOutlined-cabff1d9.js";import{D as te}from"./DownloadOutlined-28687348.js";import"./vuedraggable.umd-a1c90dfc.js";import"./index-9d5a19c2.js";import"./Group-db28a0f9.js";import"./createForOfIteratorHelper-a50550d1.js";import"./index-ffe2e608.js";import"./css-aae66f86.js";import"./useMaxLevel-5fff0ff6.js";import"./index-5353e7c4.js";import"./RadioButton-b1164875.js";import"./CaretDownOutlined-5ddc51ec.js";import"./CaretUpOutlined-d8859d1d.js";import"./iconUtil-c5959902.js";const ae={__name:"operation-record-search",emits:["search"],setup(a,{emit:s}){const{form:_,resetFields:p}=j({username:"",module:""}),f=T(["",""]),n=()=>{const[k,m]=f.value;s("search",{..._,createTimeStart:k,createTimeEnd:m})},w=()=>{p(),f.value=["",""],n()};return(k,m)=>{const o=V,l=$,r=q,g=Z,x=O,S=N,y=B,i=U;return u(),b(i,{"label-col":{xl:7,lg:5,md:7,sm:4},"wrapper-col":{xl:17,lg:19,md:17,sm:20}},{default:t(()=>[e(y,{gutter:8},{default:t(()=>[e(r,{xl:6,lg:12,md:12,sm:24,xs:24},{default:t(()=>[e(l,{label:"用户账号"},{default:t(()=>[e(o,{value:h(_).username,"onUpdate:value":m[0]||(m[0]=v=>h(_).username=v),valueModifiers:{trim:!0},placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1})]),_:1}),e(r,{xl:6,lg:12,md:12,sm:24,xs:24},{default:t(()=>[e(l,{label:"操作模块"},{default:t(()=>[e(o,{value:h(_).module,"onUpdate:value":m[1]||(m[1]=v=>h(_).module=v),valueModifiers:{trim:!0},placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1})]),_:1}),e(r,{xl:6,lg:12,md:12,sm:24,xs:24},{default:t(()=>[e(l,{label:"操作时间"},{default:t(()=>[e(g,{value:f.value,"onUpdate:value":m[2]||(m[2]=v=>f.value=v),"show-time":!0,"value-format":"YYYY-MM-DD HH:mm:ss",class:"ele-fluid"},null,8,["value"])]),_:1})]),_:1}),e(r,{xl:6,lg:12,md:12,sm:24,xs:24},{default:t(()=>[e(l,{class:"ele-text-right","wrapper-col":{span:24}},{default:t(()=>[e(S,null,{default:t(()=>[e(x,{type:"primary",onClick:n},{default:t(()=>[C("查询")]),_:1}),e(x,{onClick:w},{default:t(()=>[C("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}};const se={__name:"text-ellipsis",props:{content:String},setup(a){const s=T(!1);return(_,p)=>(u(),I("div",{class:z(["demo-text-ellipsis ele-bg-white ele-border-split",{expanded:s.value}])},[d("div",null,c(a.content),1),d("div",{class:"demo-text-ellipsis-footer ele-border-split ele-bg-white",onClick:p[0]||(p[0]=f=>s.value=!s.value)},[s.value?(u(),b(h(ee),{key:0})):(u(),b(h(Y),{key:1}))])],2))}},M=P(se,[["__scopeId","data-v-454c966c"]]),oe={class:"ele-text-secondary"},le={class:"ele-text-secondary"},ne={class:"ele-text-secondary"},re={class:"ele-text-secondary"},ie={class:"ele-text-secondary"},ce={class:"ele-text-secondary"},de={key:0,class:"ele-text-secondary"},ue={style:{margin:"12px 0"}},me={class:"ele-text-secondary"},_e={class:"ele-text-secondary"},pe={class:"ele-text-secondary"},fe={__name:"operation-record-detail",props:{visible:Boolean,data:Object},emits:["update:visible"],setup(a,{emit:s}){const _=p=>{s("update:visible",p)};return(p,f)=>{const n=$,w=q,k=E,m=B,o=H,l=U,r=G;return u(),b(r,{title:"详情",width:640,footer:null,visible:a.visible,"onUpdate:visible":_},{default:t(()=>[e(l,{class:"ele-form-detail","label-col":{sm:8,xs:6},"wrapper-col":{sm:16,xs:18}},{default:t(()=>[e(m,{gutter:16},{default:t(()=>[e(w,{sm:12,xs:24},{default:t(()=>[e(n,{label:"操作人"},{default:t(()=>[d("div",oe,c(a.data.nickname)+"("+c(a.data.username)+") ",1)]),_:1}),e(n,{label:"操作模块"},{default:t(()=>[d("div",le,c(a.data.module),1)]),_:1}),e(n,{label:"操作时间"},{default:t(()=>[d("div",ne,c(h(R)(a.data.createTime)),1)]),_:1}),e(n,{label:"请求方式"},{default:t(()=>[d("div",re,c(a.data.requestMethod),1)]),_:1})]),_:1}),e(w,{sm:12,xs:24},{default:t(()=>[e(n,{label:"IP地址"},{default:t(()=>[d("div",ie,c(a.data.ip),1)]),_:1}),e(n,{label:"操作功能"},{default:t(()=>[d("div",ce,c(a.data.description),1)]),_:1}),e(n,{label:"请求耗时"},{default:t(()=>[isNaN(a.data.spendTime)?D("",!0):(u(),I("div",de,c(a.data.spendTime/1e3)+"s ",1))]),_:1}),e(n,{label:"请求状态"},{default:t(()=>[e(k,{color:["green","red"][a.data.status]},{default:t(()=>[C(c(["正常","异常"][a.data.status]),1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1}),d("div",ue,[e(o)]),e(n,{label:"请求地址","label-col":{sm:4,xs:6},"wrapper-col":{sm:20,xs:18}},{default:t(()=>[d("div",me,c(a.data.url),1)]),_:1}),e(n,{label:"调用方法","label-col":{sm:4,xs:6},"wrapper-col":{sm:20,xs:18}},{default:t(()=>[d("div",_e,c(a.data.method),1)]),_:1}),e(n,{label:"请求参数","label-col":{sm:4,xs:6},"wrapper-col":{sm:20,xs:18}},{default:t(()=>[d("div",pe,c(a.data.params),1)]),_:1}),a.data.status===0?(u(),b(n,{key:0,label:"返回结果","label-col":{sm:4,xs:6},"wrapper-col":{sm:20,xs:18}},{default:t(()=>[e(M,{content:a.data.result,class:"ele-text-secondary"},null,8,["content"])]),_:1})):(u(),b(n,{key:1,label:"异常信息","label-col":{sm:4,xs:6},"wrapper-col":{sm:20,xs:18}},{default:t(()=>[e(M,{content:a.data.error,class:"ele-text-secondary"},null,8,["content"])]),_:1}))]),_:1})]),_:1},8,["visible"])}}};async function xe(a){const s=await F.get("/system/operation-record/page",{params:a});return s.data.code===0?s.data.data:Promise.reject(new Error(s.data.message))}async function ve(a){const s=await F.get("/system/operation-record",{params:a});return s.data.code===0&&s.data.data?s.data.data:Promise.reject(new Error(s.data.message))}const he={class:"ele-body"},be=d("span",null,"导出",-1),ge=["onClick"],ye={name:"SystemOperationRecord"},Ae=Object.assign(ye,{setup(a){const s=T(null),_=T([{key:"index",width:48,align:"center",fixed:"left",hideInSetting:!0,customRender:({index:o})=>{var l,r;return o+((r=(l=s.value)==null?void 0:l.tableIndex)!=null?r:0)}},{title:"账号",dataIndex:"username",sorter:!0,showSorterTooltip:!1,ellipsis:!0},{title:"用户名",dataIndex:"nickname",sorter:!0,showSorterTooltip:!1,ellipsis:!0},{title:"操作模块",dataIndex:"module",sorter:!0,showSorterTooltip:!1,ellipsis:!0},{title:"操作功能",dataIndex:"description",sorter:!0,showSorterTooltip:!1,ellipsis:!0},{title:"请求地址",dataIndex:"url",sorter:!0,showSorterTooltip:!1,ellipsis:!0},{title:"请求方式",dataIndex:"requestMethod",sorter:!0,showSorterTooltip:!1,width:100,align:"center"},{title:"状态",key:"status",dataIndex:"status",sorter:!0,showSorterTooltip:!1,width:100,filters:[{text:"正常",value:0},{text:"异常",value:1}],filterMultiple:!1,align:"center"},{title:"耗时",dataIndex:"spendTime",sorter:!0,showSorterTooltip:!1,width:100,customRender:({text:o})=>o/1e3+"s"},{title:"操作时间",dataIndex:"createTime",sorter:!0,showSorterTooltip:!1,ellipsis:!0,customRender:({text:o})=>R(o),align:"center"},{title:"操作",key:"action",width:90,align:"center",fixed:"right"}]),p=T({module:"",description:"",url:"",requestMethod:"",method:"",params:"",result:"",error:"",spendTime:0,os:"",device:"",browser:"",ip:"",status:0,createTime:"",nickname:"",username:""}),f=T(!1),n=({page:o,limit:l,where:r,orders:g,filters:x})=>xe({...r,...g,...x,page:o,limit:l}),w=o=>{var l;(l=s==null?void 0:s.value)==null||l.reload({page:1,where:o})},k=o=>{p.value=o,f.value=!0},m=()=>{var r;const o=[["账号","用户名","操作模块","操作功能","请求地址","请求方式","状态","耗时","操作时间"]],l=A("请求中..",0);(r=s.value)==null||r.doRequest(({where:g,orders:x,filters:S})=>{ve({...g,...x,...S}).then(y=>{l(),y.forEach(i=>{o.push([i.username,i.nickname,i.module,i.description,i.url,i.requestMethod,["正常","异常"][i.status],i.spendTime/1e3+"s",R(i.createTime)])}),W({SheetNames:["Sheet1"],Sheets:{Sheet1:X.aoa_to_sheet(o)}},"操作日志.xlsx")}).catch(y=>{l(),J.error(y.message)})})};return(o,l)=>{const r=O,g=N,x=E,S=Q,y=K;return u(),I("div",he,[e(y,{bordered:!1},{default:t(()=>[e(ae,{onSearch:w}),e(S,{ref_key:"tableRef",ref:s,"row-key":"id",columns:_.value,datasource:n,scroll:{x:1e3},"cache-key":"proSystemOperationRecordTable"},{toolbar:t(()=>[e(g,null,{default:t(()=>[e(r,{type:"primary",class:"ele-btn-icon",onClick:m},{icon:t(()=>[e(h(te))]),default:t(()=>[be]),_:1})]),_:1})]),bodyCell:t(({column:i,record:v})=>[i.key==="status"?(u(),I(L,{key:0},[v.status===0?(u(),b(x,{key:0,color:"green"},{default:t(()=>[C("正常")]),_:1})):v.status===1?(u(),b(x,{key:1,color:"red"},{default:t(()=>[C("异常")]),_:1})):D("",!0)],64)):i.key==="action"?(u(),I("a",{key:1,onClick:we=>k(v)},"详情",8,ge)):D("",!0)]),_:1},8,["columns"])]),_:1}),e(fe,{visible:f.value,"onUpdate:visible":l[0]||(l[0]=i=>f.value=i),data:p.value},null,8,["visible","data"])])}}});export{Ae as default};
