import{cY as I,r as c,aG as N,a as O,E as T,o as v,c as g,w as s,b as l,u as t,an as $,e as b,m as x,dc as w,dd as z,ax as E,aw as M,c_ as j,aH as G,ar as H,g as S,az as A}from"./index-08ed677d.js";import{D as J}from"./index-ff37d263.js";import{e as K,p as L,_ as Q,a as W}from"./sex-select-ace87578.js";import{c as X,u as Z,a as ee}from"./index-aea5eae0.js";const se={__name:"edit-form",props:{data:Object},setup(h){const p=h,{currentRoute:_,push:y}=I(),d=c(null),i=c(!1),m=c(!1),{form:a,resetFields:k,assignFields:U}=N({userId:void 0,username:"",nickname:"",sex:void 0,roles:[],email:"",phone:"",password:"",introduction:"",birthday:""}),P=O({username:[{required:!0,type:"string",validator:(o,e)=>new Promise((u,n)=>{if(!e)return n("请输入用户账号");X("username",e,a.userId).then(()=>{n("账号已经存在")}).catch(()=>{u()})}),trigger:"blur"}],nickname:[{required:!0,message:"请输入用户名",type:"string",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",type:"string",trigger:"blur"}],roles:[{required:!0,message:"请选择角色",type:"array",trigger:"blur"}],email:[{pattern:K,message:"邮箱格式不正确",type:"string",trigger:"blur"}],password:[{required:!0,type:"string",validator:async(o,e)=>i.value||/^[\S]{5,18}$/.test(e)?Promise.resolve():Promise.reject("密码必须为5-18位非空白字符"),trigger:"blur"}],phone:[{pattern:L,message:"手机号格式不正确",type:"string",trigger:"blur"}]}),D=()=>{d.value&&d.value.validate().then(()=>{m.value=!0,(i.value?Z:ee)(a).then(e=>{m.value=!1,x.success(e),q()}).catch(e=>{m.value=!1,x.error(e.message)})}).catch(()=>{})},R=()=>{w({key:t(_).path}),y("/list/basic")},q=()=>{w({key:t(_).path}),z({fullPath:"/list/basic"})};return T(()=>p.data,()=>{var o;p.data?(U({...p.data,password:""}),i.value=!0):(i.value=!1,k(),(o=d.value)==null||o.clearValidate())},{immediate:!0}),(o,e)=>{const u=E,n=M,C=J,Y=j,F=G,f=H,V=S,B=A;return v(),g(B,{ref_key:"formRef",ref:d,model:t(a),rules:P,"label-col":{sm:4,xs:24},"wrapper-col":{sm:20,xs:24},style:{"max-width":"600px",margin:"0 auto"}},{default:s(()=>[l(n,{label:"用户账号",name:"username"},{default:s(()=>[l(u,{"allow-clear":"",maxlength:20,placeholder:"请输入用户账号",value:t(a).username,"onUpdate:value":e[0]||(e[0]=r=>t(a).username=r)},null,8,["value"])]),_:1}),l(n,{label:"用户名",name:"nickname"},{default:s(()=>[l(u,{"allow-clear":"",maxlength:20,placeholder:"请输入用户名",value:t(a).nickname,"onUpdate:value":e[1]||(e[1]=r=>t(a).nickname=r)},null,8,["value"])]),_:1}),l(n,{label:"性别",name:"sex"},{default:s(()=>[l(Q,{value:t(a).sex,"onUpdate:value":e[2]||(e[2]=r=>t(a).sex=r)},null,8,["value"])]),_:1}),l(n,{label:"角色",name:"roles"},{default:s(()=>[l(W,{value:t(a).roles,"onUpdate:value":e[3]||(e[3]=r=>t(a).roles=r)},null,8,["value"])]),_:1}),l(n,{label:"邮箱",name:"email"},{default:s(()=>[l(u,{"allow-clear":"",maxlength:100,placeholder:"请输入邮箱",value:t(a).email,"onUpdate:value":e[4]||(e[4]=r=>t(a).email=r)},null,8,["value"])]),_:1}),l(n,{label:"手机号",name:"phone"},{default:s(()=>[l(u,{"allow-clear":"",maxlength:11,placeholder:"请输入手机号",value:t(a).phone,"onUpdate:value":e[5]||(e[5]=r=>t(a).phone=r)},null,8,["value"])]),_:1}),l(n,{label:"出生日期"},{default:s(()=>[l(C,{class:"ele-fluid",placeholder:"请选择出生日期","value-format":"YYYY-MM-DD",value:t(a).birthday,"onUpdate:value":e[6]||(e[6]=r=>t(a).birthday=r)},null,8,["value"])]),_:1}),i.value?$("",!0):(v(),g(n,{key:0,label:"登录密码",name:"password"},{default:s(()=>[l(Y,{maxlength:20,value:t(a).password,"onUpdate:value":e[7]||(e[7]=r=>t(a).password=r),placeholder:"请输入登录密码"},null,8,["value"])]),_:1})),l(n,{label:"个人简介"},{default:s(()=>[l(F,{rows:4,maxlength:200,placeholder:"请输入个人简介",value:t(a).introduction,"onUpdate:value":e[8]||(e[8]=r=>t(a).introduction=r)},null,8,["value"])]),_:1}),l(n,{"wrapper-col":{sm:{offset:4}}},{default:s(()=>[l(V,{size:"middle"},{default:s(()=>[l(f,{onClick:R},{default:s(()=>[b("关闭")]),_:1}),l(f,{type:"primary",loading:m.value,onClick:D},{default:s(()=>[b(" 保存 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model","rules"])}}};export{se as _};
