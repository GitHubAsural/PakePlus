import{aG as R,o as x,c as B,w as a,b as o,u as i,aQ as D,aR as O,e as F,ax as V,aw as $,ar as N,g as U,az as z,r as y,N as j,j as S,t as E,d as k,an as G,aU as b,m as r,aM as P,aV as q,h as K}from"./index-08ed677d.js";import{_ as L,a as Q,C as A}from"./index-7b650976.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./index-5362a68f.js";import{i as H}from"./index-c83262a0.js";import{_ as J}from"./index-47899940.js";import{_ as W}from"./index-26669222.js";import"./index-dc3e04fd.js";import{p as X,r as Y,a as Z,u as ee}from"./index-64ce0da4.js";import{U as te}from"./UploadOutlined-1d86f541.js";import{D as oe}from"./DeleteOutlined-a1ce9a16.js";import"./vuedraggable.umd-a1c90dfc.js";import"./index-9d5a19c2.js";import"./Group-db28a0f9.js";import"./createForOfIteratorHelper-a50550d1.js";import"./index-ffe2e608.js";import"./css-aae66f86.js";import"./useMaxLevel-5fff0ff6.js";import"./index-5353e7c4.js";import"./RadioButton-b1164875.js";import"./CaretDownOutlined-5ddc51ec.js";import"./CaretUpOutlined-d8859d1d.js";import"./iconUtil-c5959902.js";import"./DownloadOutlined-28687348.js";const ae={__name:"file-search",emits:["search"],setup(I,{emit:c}){const{form:n,resetFields:u}=R({name:"",path:"",createNickname:""}),f=()=>{c("search",n)},p=()=>{u(),f()};return(C,l)=>{const _=V,e=$,t=L,s=N,d=U,h=Q,w=z;return x(),B(w,{"label-col":{xl:7,lg:5,md:7,sm:4},"wrapper-col":{xl:17,lg:19,md:17,sm:20}},{default:a(()=>[o(h,{gutter:8},{default:a(()=>[o(t,{xl:6,lg:12,md:12,sm:24,xs:24},{default:a(()=>[o(e,{label:"文件名称"},{default:a(()=>[o(_,{value:i(n).name,"onUpdate:value":l[0]||(l[0]=m=>i(n).name=m),valueModifiers:{trim:!0},placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1})]),_:1}),o(t,D(O({xl:6,lg:12,md:12,sm:24,xs:24})),{default:a(()=>[o(e,{label:"文件路径"},{default:a(()=>[o(_,{value:i(n).path,"onUpdate:value":l[1]||(l[1]=m=>i(n).path=m),valueModifiers:{trim:!0},placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1})]),_:1},16),o(t,{xl:6,lg:12,md:12,sm:24,xs:24},{default:a(()=>[o(e,{label:"上传人"},{default:a(()=>[o(_,{value:i(n).createNickname,"onUpdate:value":l[2]||(l[2]=m=>i(n).createNickname=m),valueModifiers:{trim:!0},placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1})]),_:1}),o(t,{xl:6,lg:12,md:12,sm:24,xs:24},{default:a(()=>[o(e,{class:"ele-text-right","wrapper-col":{span:24}},{default:a(()=>[o(d,null,{default:a(()=>[o(s,{type:"primary",onClick:f},{default:a(()=>[F("查询")]),_:1}),o(s,{onClick:p},{default:a(()=>[F("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},se={class:"ele-body"},ne=k("span",null,"上传",-1),le=k("span",null,"删除",-1),re=["href"],ie=["href"],ce=k("a",{class:"ele-text-danger"},"删除",-1),ue={name:"SystemFile"},je=Object.assign(ue,{setup(I){const c=y(null),n=y([{key:"index",width:48,align:"center",fixed:"left",hideInSetting:!0,customRender:({index:e})=>{var t,s;return e+((s=(t=c.value)==null?void 0:t.tableIndex)!=null?s:0)}},{title:"文件名称",dataIndex:"name",sorter:!0,showSorterTooltip:!1,ellipsis:!0},{title:"文件路径",key:"path",dataIndex:"path",sorter:!0,showSorterTooltip:!1,ellipsis:!0},{title:"文件大小",dataIndex:"length",sorter:!0,showSorterTooltip:!1,ellipsis:!0,customRender:({text:e})=>e<1024?e+"B":e<1024*1024?(e/1024).toFixed(1)+"KB":e<1024*1024*1024?(e/1024/1024).toFixed(1)+"M":(e/1024/1024/1024).toFixed(1)+"G",width:120},{title:"上传人",dataIndex:"createNickname",sorter:!0,showSorterTooltip:!1,ellipsis:!0,width:120},{title:"上传时间",dataIndex:"createTime",sorter:!0,showSorterTooltip:!1,ellipsis:!0,customRender:({text:e})=>j(e),width:160},{title:"操作",key:"action",width:120,align:"center"}]),u=y([]),f=({page:e,limit:t,where:s,orders:d})=>X({...s,...d,page:e,limit:t}),p=e=>{var t;u.value=[],(t=c==null?void 0:c.value)==null||t.reload({page:1,where:e})},C=e=>{const t=b("请求中..",0);Y(e.id).then(s=>{t(),r.success(s),p()}).catch(s=>{t(),r.error(s.message)})},l=()=>{if(!u.value.length){r.error("请至少选择一条数据");return}P.confirm({title:"提示",content:"确定要删除选中的文件吗?",icon:o(q),maskClosable:!0,onOk:()=>{const e=b("请求中..",0);Z(u.value.map(t=>t.id)).then(t=>{e(),r.success(t),p()}).catch(t=>{e(),r.error(t.message)})}})},_=({file:e})=>{if(e.size/1024/1024>100)return r.error("大小不能超过 100MB"),!1;const t=b({content:"上传中..",duration:0,mask:!0});return ee(e).then(()=>{t(),r.success("上传成功"),p()}).catch(s=>{t(),r.error(s.message)}),!1};return(e,t)=>{const s=N,d=W,h=U,w=K,m=J,T=H,M=A;return x(),S("div",se,[o(M,{bordered:!1},{default:a(()=>[o(ae,{onSearch:p}),o(T,{ref_key:"tableRef",ref:c,"row-key":"id",columns:n.value,datasource:f,selection:u.value,"onUpdate:selection":t[0]||(t[0]=g=>u.value=g),scroll:{x:800},"cache-key":"proSystemFileTable"},{toolbar:a(()=>[o(h,null,{default:a(()=>[o(d,{"show-upload-list":!1,customRequest:_},{default:a(()=>[o(s,{type:"primary",class:"ele-btn-icon"},{icon:a(()=>[o(i(te))]),default:a(()=>[ne]),_:1})]),_:1}),o(s,{danger:"",type:"primary",class:"ele-btn-icon",onClick:l},{icon:a(()=>[o(i(oe))]),default:a(()=>[le]),_:1})]),_:1})]),bodyCell:a(({column:g,record:v})=>[g.key==="path"?(x(),S("a",{key:0,href:v.url,target:"_blank"},E(v.path),9,re)):g.key==="action"?(x(),B(h,{key:1},{default:a(()=>[k("a",{href:v.downloadUrl,target:"_blank"},"下载",8,ie),o(w,{type:"vertical"}),o(m,{placement:"topRight",title:"确定要删除此文件吗？",onConfirm:me=>C(v)},{default:a(()=>[ce]),_:2},1032,["onConfirm"])]),_:2},1024)):G("",!0)]),_:1},8,["columns","selection"])]),_:1})])}}});export{je as default};
