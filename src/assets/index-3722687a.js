import{aG as T,o as h,c as I,w as o,b as a,u as s,bF as ne,b5 as P,d as $,ax as E,ar as A,g as q,r as f,a as K,E as R,an as V,m as w,aw as M,c_ as oe,aH as H,az as G,aq as J,_ as Q,N as le,j as O,F,k as W,e as X,t as Y,aU as Z,ao as se,au as re,h as ie,p as ee,i as ae,aB as ue,aC as de,s as D,ai as ce,ds as pe,cx as me,aM as _e,aV as ge}from"./index-08ed677d.js";import{_ as B,a as L,C as ve}from"./index-7b650976.js";import{i as fe}from"./index-f7893746.js";/* empty css              */import{i as be}from"./index-5362a68f.js";/* empty css              *//* empty css              *//* empty css              */import{i as ye}from"./index-c83262a0.js";import{_ as he}from"./index-47899940.js";import{_ as xe}from"./index-121f398a.js";import{e as ze,p as ke,_ as we,a as Ie}from"./sex-select-ace87578.js";import{c as Ue,u as Ne,a as $e,p as Se,r as Ce,b as Oe}from"./index-aea5eae0.js";import{_ as De}from"./index-0a7d1a68.js";import{l as Fe}from"./index-7fed3626.js";import{c as Te}from"./index-ffe2e608.js";import{E as Ee}from"./EditOutlined-44a63741.js";import{D as qe}from"./DeleteOutlined-a1ce9a16.js";import"./CaretUpOutlined-d8859d1d.js";import"./vuedraggable.umd-a1c90dfc.js";import"./index-9d5a19c2.js";import"./Group-db28a0f9.js";import"./createForOfIteratorHelper-a50550d1.js";import"./iconUtil-c5959902.js";import"./useMaxLevel-5fff0ff6.js";import"./index-91c24823.js";import"./UpOutlined-cabff1d9.js";import"./css-aae66f86.js";import"./index-5353e7c4.js";import"./RadioButton-b1164875.js";import"./CaretDownOutlined-5ddc51ec.js";const Re=$("span",null,"查询",-1),Ve=$("span",null,"新建",-1),Be={__name:"org-user-search",emits:["search","add"],setup(r,{emit:i}){const{form:u}=T({username:"",nickname:""}),_=()=>{i("search",u)},c=()=>{i("add")};return(p,n)=>{const b=E,g=B,U=A,N=q,m=L;return h(),I(m,{gutter:16},{default:o(()=>[a(g,{xl:6,lg:8,md:12,sm:24,xs:24},{default:o(()=>[a(b,{value:s(u).username,"onUpdate:value":n[0]||(n[0]=t=>s(u).username=t),valueModifiers:{trim:!0},placeholder:"请输入用户账号","allow-clear":""},null,8,["value"])]),_:1}),a(g,{xl:6,lg:8,md:12,sm:24,xs:24},{default:o(()=>[a(b,{value:s(u).nickname,"onUpdate:value":n[1]||(n[1]=t=>s(u).nickname=t),valueModifiers:{trim:!0},placeholder:"请输入用户名","allow-clear":""},null,8,["value"])]),_:1}),a(g,{xl:12,lg:8,md:24,sm:24,xs:24},{default:o(()=>[a(N,{size:10,style:{"flex-wrap":"wrap"}},{default:o(()=>[a(U,{type:"primary",class:"ele-btn-icon",onClick:_},{icon:o(()=>[a(s(ne))]),default:o(()=>[Re]),_:1}),a(U,{type:"primary",class:"ele-btn-icon",onClick:c},{icon:o(()=>[a(s(P))]),default:o(()=>[Ve]),_:1})]),_:1})]),_:1})]),_:1})}}},te={__name:"org-select",props:{value:Number,placeholder:{type:String,default:"请选择角色"},data:Array},emits:["update:value"],setup(r,{emit:i}){const u=_=>{i("update:value",_)};return(_,c)=>{const p=xe;return h(),I(p,{"allow-clear":"","tree-default-expand-all":"",placeholder:r.placeholder,value:r.value||void 0,"tree-data":r.data,"dropdown-style":{maxHeight:"360px",overflow:"auto"},"onUpdate:value":u},null,8,["placeholder","value","tree-data"])}}},Le={__name:"org-user-edit",props:{visible:Boolean,data:Object,organizationList:Array,organizationId:Number},emits:["done","update:visible"],setup(r,{emit:i}){const u=r,_=f(null),c=f(!1),p=f(!1),{form:n,resetFields:b,assignFields:g}=T({userId:void 0,organizationId:void 0,username:"",nickname:"",sex:void 0,roles:[],email:"",phone:"",password:"",introduction:""}),U=K({username:[{required:!0,type:"string",validator:(t,e)=>new Promise((l,y)=>{var x;if(!e)return y("请输入用户账号");Ue("username",e,(x=u.data)==null?void 0:x.userId).then(()=>{y("账号已经存在")}).catch(()=>{l()})}),trigger:"blur"}],nickname:[{required:!0,message:"请输入用户名",type:"string",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",type:"string",trigger:"blur"}],roleIds:[{required:!0,message:"请选择角色",type:"array",trigger:"blur"}],email:[{pattern:ze,message:"邮箱格式不正确",type:"string",trigger:"blur"}],password:[{required:!0,type:"string",validator:async(t,e)=>c.value||/^[\S]{5,18}$/.test(e)?Promise.resolve():Promise.reject("密码必须为5-18位非空白字符"),trigger:"blur"}],phone:[{pattern:ke,message:"手机号格式不正确",type:"string",trigger:"blur"}]}),N=()=>{_.value&&_.value.validate().then(()=>{p.value=!0,(c.value?Ne:$e)(n).then(e=>{p.value=!1,w.success(e),m(!1),i("done")}).catch(e=>{p.value=!1,w.error(e.message)})}).catch(()=>{})},m=t=>{i("update:visible",t)};return R(()=>u.visible,t=>{var e;t?u.data?(g(u.data),c.value=!0):(n.organizationId=u.organizationId,c.value=!1):(b(),(e=_.value)==null||e.clearValidate())}),(t,e)=>{const l=M,y=E,x=B,S=oe,C=H,z=L,k=G,v=J;return h(),I(v,{width:680,visible:r.visible,"confirm-loading":p.value,title:c.value?"修改用户":"新建用户","body-style":{paddingBottom:"8px"},"onUpdate:visible":m,onOk:N},{default:o(()=>[a(k,{ref_key:"formRef",ref:_,model:s(n),rules:U,"label-col":{md:7,sm:24},"wrapper-col":{md:17,sm:24}},{default:o(()=>[a(z,{gutter:16},{default:o(()=>[a(x,{md:12,sm:24,xs:24},{default:o(()=>[a(l,{label:"所属机构"},{default:o(()=>[a(te,{data:r.organizationList,placeholder:"请选择所属机构",value:s(n).organizationId,"onUpdate:value":e[0]||(e[0]=d=>s(n).organizationId=d)},null,8,["data","value"])]),_:1}),a(l,{label:"用户账号",name:"username"},{default:o(()=>[a(y,{"allow-clear":"",maxlength:20,placeholder:"请输入用户账号",value:s(n).username,"onUpdate:value":e[1]||(e[1]=d=>s(n).username=d)},null,8,["value"])]),_:1}),a(l,{label:"用户名",name:"nickname"},{default:o(()=>[a(y,{"allow-clear":"",maxlength:20,placeholder:"请输入用户名",value:s(n).nickname,"onUpdate:value":e[2]||(e[2]=d=>s(n).nickname=d)},null,8,["value"])]),_:1}),a(l,{label:"性别",name:"sex"},{default:o(()=>[a(we,{value:s(n).sex,"onUpdate:value":e[3]||(e[3]=d=>s(n).sex=d)},null,8,["value"])]),_:1}),a(l,{label:"角色",name:"roleIds"},{default:o(()=>[a(Ie,{value:s(n).roles,"onUpdate:value":e[4]||(e[4]=d=>s(n).roles=d)},null,8,["value"])]),_:1})]),_:1}),a(x,{md:12,sm:24,xs:24},{default:o(()=>[a(l,{label:"手机号",name:"phone"},{default:o(()=>[a(y,{"allow-clear":"",maxlength:11,placeholder:"请输入手机号",value:s(n).phone,"onUpdate:value":e[5]||(e[5]=d=>s(n).phone=d)},null,8,["value"])]),_:1}),a(l,{label:"邮箱",name:"email"},{default:o(()=>[a(y,{"allow-clear":"",maxlength:100,placeholder:"请输入邮箱",value:s(n).email,"onUpdate:value":e[6]||(e[6]=d=>s(n).email=d)},null,8,["value"])]),_:1}),c.value?V("",!0):(h(),I(l,{key:0,label:"登录密码",name:"password"},{default:o(()=>[a(S,{maxlength:20,value:s(n).password,"onUpdate:value":e[7]||(e[7]=d=>s(n).password=d),placeholder:"请输入登录密码"},null,8,["value"])]),_:1})),a(l,{label:"个人简介"},{default:o(()=>[a(C,{rows:4,maxlength:200,placeholder:"请输入个人简介",value:s(n).introduction,"onUpdate:value":e[8]||(e[8]=d=>s(n).introduction=d)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["visible","confirm-loading","title"])}}};const je=r=>(ee("data-v-4b395eed"),r=r(),ae(),r),Pe=["onClick"],Ae=je(()=>$("a",{class:"ele-text-danger"},"删除",-1)),Ke={__name:"org-user-list",props:{organizationId:Number,organizationList:Array},setup(r){const i=r,u=f(null),_=f([{key:"index",width:48,align:"center",fixed:"left",hideInSetting:!0,customRender:({index:m})=>{var t,e;return m+((e=(t=u.value)==null?void 0:t.tableIndex)!=null?e:0)}},{title:"用户账号",dataIndex:"username",sorter:!0,showSorterTooltip:!1},{title:"用户名",dataIndex:"nickname",sorter:!0,showSorterTooltip:!1},{title:"性别",dataIndex:"sexName",width:80,align:"center",sorter:!0,showSorterTooltip:!1},{title:"角色",key:"roles"},{title:"创建时间",dataIndex:"createTime",sorter:!0,showSorterTooltip:!1,ellipsis:!0,customRender:({text:m})=>le(m)},{title:"状态",key:"status",sorter:!0,showSorterTooltip:!1,width:80,align:"center"},{title:"操作",key:"action",width:100,align:"center"}]),c=f(null),p=f(!1),n=({page:m,limit:t,where:e,orders:l})=>Se({...e,...l,page:m,limit:t,organizationId:i.organizationId}),b=m=>{var t;(t=u==null?void 0:u.value)==null||t.reload({page:1,where:m})},g=m=>{c.value=m!=null?m:null,p.value=!0},U=m=>{const t=Z("请求中..",0);Ce(m.userId).then(e=>{t(),w.success(e),b()}).catch(e=>{t(),w.error(e.message)})},N=(m,t)=>{const e=m?0:1;Oe(t.userId,e).then(l=>{t.status=e,w.success(l)}).catch(l=>{w.error(l.message)})};return R(()=>i.organizationId,()=>{b()}),(m,t)=>{const e=se,l=re,y=ie,x=he,S=q,C=ye;return h(),O(F,null,[a(C,{ref_key:"tableRef",ref:u,"row-key":"userId",columns:_.value,datasource:n,height:"calc(100vh - 290px)","tool-class":"ele-toolbar-form",scroll:{x:800},"tools-theme":"default",bordered:"","cache-key":"proSystemOrgUserTable",class:"sys-org-table"},{toolbar:o(()=>[a(Be,{onSearch:b,onAdd:t[0]||(t[0]=z=>g())})]),bodyCell:o(({column:z,record:k})=>[z.key==="roles"?(h(!0),O(F,{key:0},W(k.roles,v=>(h(),I(e,{key:v.roleId,color:"blue"},{default:o(()=>[X(Y(v.roleName),1)]),_:2},1024))),128)):z.key==="status"?(h(),I(l,{key:1,checked:k.status===0,onChange:v=>N(v,k)},null,8,["checked","onChange"])):z.key==="action"?(h(),I(S,{key:2},{default:o(()=>[$("a",{onClick:v=>g(k)},"修改",8,Pe),a(y,{type:"vertical"}),a(x,{placement:"topRight",title:"确定要删除此用户吗？",onConfirm:v=>U(k)},{default:o(()=>[Ae]),_:2},1032,["onConfirm"])]),_:2},1024)):V("",!0)]),_:1},8,["columns"]),a(Le,{data:c.value,visible:p.value,"onUpdate:visible":t[1]||(t[1]=z=>p.value=z),"organization-list":r.organizationList,"organization-id":r.organizationId,onDone:b},null,8,["data","visible","organization-list","organization-id"])],64)}}},Me=Q(Ke,[["__scopeId","data-v-4b395eed"]]),He={__name:"org-type-select",props:{value:String,placeholder:{type:String,default:"请选择机构类型"}},emits:["update:value"],setup(r,{emit:i}){const u=f([]),_=c=>{i("update:value",c)};return Fe({dictCode:"organization_type"}).then(c=>{u.value=c}).catch(c=>{w.error(c.message)}),(c,p)=>{const n=ue,b=de;return h(),I(b,{"allow-clear":"",value:r.value,placeholder:r.placeholder,"onUpdate:value":_},{default:o(()=>[(h(!0),O(F,null,W(u.value,g=>(h(),I(n,{key:g.dictDataCode,value:g.dictDataCode},{default:o(()=>[X(Y(g.dictDataName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])}}};async function Ge(r){const i=await D.get("/system/organization",{params:r});return i.data.code===0&&i.data.data?i.data.data:Promise.reject(new Error(i.data.message))}async function Je(r){const i=await D.post("/system/organization",r);return i.data.code===0?i.data.message:Promise.reject(new Error(i.data.message))}async function Qe(r){const i=await D.put("/system/organization",r);return i.data.code===0?i.data.message:Promise.reject(new Error(i.data.message))}async function We(r){const i=await D.delete("/system/organization/"+r);return i.data.code===0?i.data.message:Promise.reject(new Error(i.data.message))}const Xe={__name:"org-edit",props:{visible:Boolean,data:Object,organizationId:Number,organizationList:Array},emits:["done","update:visible"],setup(r,{emit:i}){const u=r,_=f(null),c=f(!1),p=f(!1),{form:n,resetFields:b,assignFields:g}=T({organizationId:void 0,parentId:void 0,organizationName:"",organizationFullName:"",organizationCode:"",organizationType:void 0,sortNumber:void 0,comments:""}),U=K({organizationName:[{required:!0,message:"请输入机构名称",type:"string",trigger:"blur"}],organizationFullName:[{required:!0,message:"请输入机构全称",type:"string",trigger:"blur"}],organizationType:[{required:!0,message:"请选择机构类型",type:"string",trigger:"blur"}],sortNumber:[{required:!0,message:"请输入排序号",type:"number",trigger:"blur"}]}),N=()=>{_.value&&_.value.validate().then(()=>{p.value=!0;const t={...n,parentId:n.parentId||0};(c.value?Qe:Je)(t).then(l=>{p.value=!1,w.success(l),m(!1),i("done")}).catch(l=>{p.value=!1,w.error(l.message)})}).catch(()=>{})},m=t=>{i("update:visible",t)};return R(()=>u.visible,t=>{var e;t?u.data?(g(u.data),c.value=!0):(n.parentId=u.organizationId,c.value=!1):(b(),(e=_.value)==null||e.clearValidate())}),(t,e)=>{const l=M,y=E,x=B,S=De,C=H,z=L,k=G,v=J;return h(),I(v,{width:620,visible:r.visible,"confirm-loading":p.value,title:c.value?"修改机构":"添加机构","body-style":{paddingBottom:"8px"},"onUpdate:visible":m,onOk:N},{default:o(()=>[a(k,{ref_key:"formRef",ref:_,model:s(n),rules:U,"label-col":{md:7,sm:24},"wrapper-col":{md:17,sm:24}},{default:o(()=>[a(z,{gutter:16},{default:o(()=>[a(x,{md:12,sm:24,xs:24},{default:o(()=>[a(l,{label:"上级机构",name:"parentId"},{default:o(()=>[a(te,{data:r.organizationList,placeholder:"请选择上级机构",value:s(n).parentId,"onUpdate:value":e[0]||(e[0]=d=>s(n).parentId=d)},null,8,["data","value"])]),_:1}),a(l,{label:"机构名称",name:"organizationName"},{default:o(()=>[a(y,{"allow-clear":"",maxlength:20,placeholder:"请输入机构名称",value:s(n).organizationName,"onUpdate:value":e[1]||(e[1]=d=>s(n).organizationName=d)},null,8,["value"])]),_:1}),a(l,{label:"机构全称",name:"organizationFullName"},{default:o(()=>[a(y,{"allow-clear":"",maxlength:100,placeholder:"请输入机构全称",value:s(n).organizationFullName,"onUpdate:value":e[2]||(e[2]=d=>s(n).organizationFullName=d)},null,8,["value"])]),_:1}),a(l,{label:"机构代码"},{default:o(()=>[a(y,{"allow-clear":"",maxlength:20,placeholder:"请输入机构代码",value:s(n).organizationCode,"onUpdate:value":e[3]||(e[3]=d=>s(n).organizationCode=d)},null,8,["value"])]),_:1})]),_:1}),a(x,{md:12,sm:24,xs:24},{default:o(()=>[a(l,{label:"机构类型",name:"organizationType"},{default:o(()=>[a(He,{value:s(n).organizationType,"onUpdate:value":e[4]||(e[4]=d=>s(n).organizationType=d)},null,8,["value"])]),_:1}),a(l,{label:"排序号",name:"sortNumber"},{default:o(()=>[a(S,{min:0,max:99999,class:"ele-fluid",placeholder:"请输入排序号",value:s(n).sortNumber,"onUpdate:value":e[5]||(e[5]=d=>s(n).sortNumber=d)},null,8,["value"])]),_:1}),a(l,{label:"备注"},{default:o(()=>[a(C,{rows:4,maxlength:200,placeholder:"请输入备注",value:s(n).comments,"onUpdate:value":e[6]||(e[6]=d=>s(n).comments=d)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["visible","confirm-loading","title"])}}};const j=r=>(ee("data-v-21b04cad"),r=r(),ae(),r),Ye={class:"ele-body"},Ze=j(()=>$("span",null,"新建",-1)),ea=j(()=>$("span",null,"修改",-1)),aa=j(()=>$("span",null,"删除",-1)),ta={class:"ele-border-split sys-organization-list"},na={name:"SystemOrganization"},oa=Object.assign(na,{setup(r){const i=f(!0),u=f([]),_=f([]),c=f([]),p=f(null),n=f(!1),b=f(null),g=()=>{i.value=!0,Ge().then(t=>{i.value=!1;const e=[];t.forEach(l=>{l.key=l.organizationId,l.value=l.organizationId,l.title=l.organizationName,typeof l.key=="number"&&e.push(l.key)}),_.value=e,u.value=pe({data:t,idField:"organizationId",parentIdField:"parentId"}),t.length?(typeof t[0].key=="number"&&(c.value=[t[0].key]),p.value=t[0]):(c.value=[],p.value=null)}).catch(t=>{i.value=!1,w.error(t.message)})},U=()=>{me(u.value,t=>{if(typeof t.key=="number"&&c.value.includes(t.key))return p.value=t,!1})},N=t=>{b.value=t!=null?t:null,n.value=!0},m=()=>{_e.confirm({title:"提示",content:"确定要删除选中的机构吗?",icon:a(ge),maskClosable:!0,onOk:()=>{var e;const t=Z("请求中..",0);We((e=p.value)==null?void 0:e.organizationId).then(l=>{t(),w.success(l),g()}).catch(l=>{t(),w.error(l.message)})}})};return g(),(t,e)=>{var k;const l=A,y=q,x=be,S=Te,C=fe,z=ve;return h(),O("div",Ye,[a(z,{bordered:!1,"body-style":{padding:"16px"}},{default:o(()=>[a(C,{width:"266px","allow-collapse":"","right-style":{overflow:"hidden"},style:ce({minHeight:"calc(100vh - 152px)"})},{content:o(()=>[p.value?(h(),I(Me,{key:0,"organization-list":u.value,"organization-id":p.value.organizationId},null,8,["organization-list","organization-id"])):V("",!0)]),default:o(()=>[$("div",null,[a(x,{theme:"default"},{default:o(()=>[a(y,{size:10},{default:o(()=>[a(l,{type:"primary",class:"ele-btn-icon",onClick:e[0]||(e[0]=v=>N())},{icon:o(()=>[a(s(P))]),default:o(()=>[Ze]),_:1}),a(l,{type:"primary",disabled:!p.value,class:"ele-btn-icon",onClick:e[1]||(e[1]=v=>N(p.value))},{icon:o(()=>[a(s(Ee))]),default:o(()=>[ea]),_:1},8,["disabled"]),a(l,{danger:"",type:"primary",disabled:!p.value,class:"ele-btn-icon",onClick:m},{icon:o(()=>[a(s(qe))]),default:o(()=>[aa]),_:1},8,["disabled"])]),_:1})]),_:1}),$("div",ta,[a(S,{"tree-data":u.value,"expanded-keys":_.value,"onUpdate:expandedKeys":e[2]||(e[2]=v=>_.value=v),"selected-keys":c.value,"onUpdate:selectedKeys":e[3]||(e[3]=v=>c.value=v),onSelect:U},null,8,["tree-data","expanded-keys","selected-keys"])])])]),_:1},8,["style"])]),_:1}),a(Xe,{visible:n.value,"onUpdate:visible":e[4]||(e[4]=v=>n.value=v),data:b.value,"organization-list":u.value,"organization-id":(k=p.value)==null?void 0:k.organizationId,onDone:g},null,8,["visible","data","organization-list","organization-id"])])}}}),qa=Q(oa,[["__scopeId","data-v-21b04cad"]]);export{qa as default};
